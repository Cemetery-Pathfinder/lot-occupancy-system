"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.los,l=document.querySelector("#container--lotTypes");let o=exports.lotTypes;delete exports.lotTypes;const n=new Set;function i(e){var t;const l=e.currentTarget,o=l.closest(".container--lotType"),i=Number.parseInt(null!==(t=o.dataset.lotTypeId)&&void 0!==t?t:"",10);n.has(i)?n.delete(i):n.add(i),l.innerHTML=n.has(i)?'<i class="fas fa-fw fa-minus" aria-hidden="true"></i>':'<i class="fas fa-fw fa-plus" aria-hidden="true"></i>';const s=o.querySelectorAll(".panel-block");for(const e of s)e.classList.toggle("is-hidden")}function s(e){var l;const n=e;n.success?(o=n.lotTypes,T()):bulmaJS.alert({title:`Error Updating ${t.escapedAliases.Lot} Type`,message:null!==(l=n.errorMessage)&&void 0!==l?l:"",contextualColorName:"danger"})}function d(e){var l;const o=Number.parseInt(null!==(l=e.currentTarget.closest(".container--lotType").dataset.lotTypeId)&&void 0!==l?l:"",10);bulmaJS.confirm({title:`Delete ${t.escapedAliases.Lot} Type`,message:`Are you sure you want to delete this ${t.escapedAliases.lot} type?`,contextualColorName:"warning",okButton:{text:`Yes, Delete ${t.escapedAliases.Lot} Type`,callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/admin/doDeleteLotType`,{lotTypeId:o},s)}}})}function a(e){var l;const n=Number.parseInt(null!==(l=e.currentTarget.closest(".container--lotType").dataset.lotTypeId)&&void 0!==l?l:"",10),i=o.find(e=>n===e.lotTypeId);let d;function a(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/admin/doUpdateLotType`,e.currentTarget,e=>{const t=e;s(t),t.success&&d()})}cityssm.openHtmlModal("adminLotTypes-editLotType",{onshow(e){t.populateAliases(e),e.querySelector("#lotTypeEdit--lotTypeId").value=n.toString(),e.querySelector("#lotTypeEdit--lotType").value=i.lotType},onshown(e,t){var l;d=t,e.querySelector("#lotTypeEdit--lotType").focus(),null===(l=e.querySelector("form"))||void 0===l||l.addEventListener("submit",a),bulmaJS.toggleHtmlClipped()},onremoved(){bulmaJS.toggleHtmlClipped()}})}function r(e){var l;const o=Number.parseInt(null!==(l=e.currentTarget.closest(".container--lotType").dataset.lotTypeId)&&void 0!==l?l:"",10);let i;function d(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/admin/doAddLotTypeField`,e.currentTarget,e=>{const t=e;n.add(o),s(t),t.success&&(i(),u(o,t.lotTypeFieldId))})}cityssm.openHtmlModal("adminLotTypes-addLotTypeField",{onshow(e){t.populateAliases(e),o&&(e.querySelector("#lotTypeFieldAdd--lotTypeId").value=o.toString())},onshown(e,t){var l;i=t,e.querySelector("#lotTypeFieldAdd--lotTypeField").focus(),null===(l=e.querySelector("form"))||void 0===l||l.addEventListener("submit",d),bulmaJS.toggleHtmlClipped()},onremoved(){bulmaJS.toggleHtmlClipped()}})}function c(e){const l=e.currentTarget,o=l.closest(".container--lotType").dataset.lotTypeId;cityssm.postJSON(t.urlPrefix+"/admin/"+("up"===l.dataset.direction?"doMoveLotTypeUp":"doMoveLotTypeDown"),{lotTypeId:o,moveToEnd:e.shiftKey?"1":"0"},s)}function u(e,l){var n;const i=(null!==(n=o.find(t=>t.lotTypeId===e).lotTypeFields)&&void 0!==n?n:[]).find(e=>e.lotTypeFieldId===l);let d,a,r,c,u;function p(){a.min=d.value}function y(){""===c.value?(d.disabled=!1,a.disabled=!1,r.disabled=!1):(d.disabled=!0,a.disabled=!0,r.disabled=!0)}function v(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/admin/doUpdateLotTypeField`,e.currentTarget,e=>{const t=e;s(t),t.success&&u()})}function T(){cityssm.postJSON(`${t.urlPrefix}/admin/doDeleteLotTypeField`,{lotTypeFieldId:l},e=>{const t=e;s(t),t.success&&u()})}function m(){bulmaJS.confirm({title:"Delete Field",message:"Are you sure you want to delete this field?  Note that historical records that make use of this field will not be affected.",contextualColorName:"warning",okButton:{text:"Yes, Delete Field",callbackFunction:T}})}cityssm.openHtmlModal("adminLotTypes-editLotTypeField",{onshow(e){var l,o,n,s,u,p,v;t.populateAliases(e),e.querySelector("#lotTypeFieldEdit--lotTypeFieldId").value=i.lotTypeFieldId.toString(),e.querySelector("#lotTypeFieldEdit--lotTypeField").value=null!==(l=i.lotTypeField)&&void 0!==l?l:"",e.querySelector("#lotTypeFieldEdit--isRequired").value=i.isRequired?"1":"0",(d=e.querySelector("#lotTypeFieldEdit--minimumLength")).value=null!==(n=null===(o=i.minimumLength)||void 0===o?void 0:o.toString())&&void 0!==n?n:"",(a=e.querySelector("#lotTypeFieldEdit--maximumLength")).value=null!==(u=null===(s=i.maximumLength)||void 0===s?void 0:s.toString())&&void 0!==u?u:"",(r=e.querySelector("#lotTypeFieldEdit--pattern")).value=null!==(p=i.pattern)&&void 0!==p?p:"",(c=e.querySelector("#lotTypeFieldEdit--lotTypeFieldValues")).value=null!==(v=i.lotTypeFieldValues)&&void 0!==v?v:"",y()},onshown(e,t){var l,o;u=t,bulmaJS.init(e),bulmaJS.toggleHtmlClipped(),cityssm.enableNavBlocker(),null===(l=e.querySelector("form"))||void 0===l||l.addEventListener("submit",v),d.addEventListener("keyup",p),p(),c.addEventListener("keyup",y),null===(o=e.querySelector("#button--deleteLotTypeField"))||void 0===o||o.addEventListener("click",m)},onremoved(){bulmaJS.toggleHtmlClipped(),cityssm.disableNavBlocker()}})}function p(e){var t,l;e.preventDefault();const o=Number.parseInt(null!==(t=e.currentTarget.closest(".container--lotTypeField").dataset.lotTypeFieldId)&&void 0!==t?t:"",10);u(Number.parseInt(null!==(l=e.currentTarget.closest(".container--lotType").dataset.lotTypeId)&&void 0!==l?l:"",10),o)}function y(e){const l=e.currentTarget,o=l.closest(".container--lotTypeField").dataset.lotTypeFieldId;cityssm.postJSON(t.urlPrefix+"/admin/"+("up"===l.dataset.direction?"doMoveLotTypeFieldUp":"doMoveLotTypeFieldDown"),{lotTypeFieldId:o,moveToEnd:e.shiftKey?"1":"0"},s)}function v(e,l,o){var i,s;if(0===o.length)e.insertAdjacentHTML("beforeend",`<div class="panel-block is-block\n          ${n.has(l)?"":" is-hidden"}">\n          <div class="message is-info"><p class="message-body">There are no additional fields.</p></div>\n          </div>`);else for(const d of o){const o=document.createElement("div");o.className="panel-block is-block container--lotTypeField",n.has(l)||o.classList.add("is-hidden"),o.dataset.lotTypeFieldId=d.lotTypeFieldId.toString(),o.innerHTML=`<div class="level is-mobile">\n          <div class="level-left">\n            <div class="level-item">\n              <a class="has-text-weight-bold button--editLotTypeField" href="#">\n                ${cityssm.escapeHTML(null!==(i=d.lotTypeField)&&void 0!==i?i:"")}\n              </a>\n            </div>\n          </div>\n          <div class="level-right">\n            <div class="level-item">\n              ${t.getMoveUpDownButtonFieldHTML("button--moveLotTypeFieldUp","button--moveLotTypeFieldDown")}\n            </div>\n          </div>\n          </div>`,null===(s=o.querySelector(".button--editLotTypeField"))||void 0===s||s.addEventListener("click",p),o.querySelector(".button--moveLotTypeFieldUp").addEventListener("click",y),o.querySelector(".button--moveLotTypeFieldDown").addEventListener("click",y),e.append(o)}}function T(){var e,s,u,p,y;if(l.innerHTML="",0!==o.length)for(const T of o){const o=document.createElement("div");o.className="panel container--lotType",o.dataset.lotTypeId=T.lotTypeId.toString(),o.innerHTML=`<div class="panel-heading">\n        <div class="level is-mobile">\n          <div class="level-left">\n            <div class="level-item">\n              <button class="button is-small button--toggleLotTypeFields" data-tooltip="Toggle Fields" type="button" aria-label="Toggle Fields">\n              ${n.has(T.lotTypeId)?'<i class="fas fa-fw fa-minus" aria-hidden="true"></i>':'<i class="fas fa-fw fa-plus" aria-hidden="true"></i>'}\n              </button>\n            </div>\n            <div class="level-item">\n              <h2 class="title is-4">${cityssm.escapeHTML(T.lotType)}</h2>\n            </div>\n          </div>\n          <div class="level-right">\n            <div class="level-item">\n              <button class="button is-danger is-small button--deleteLotType" type="button">\n                <span class="icon is-small"><i class="fas fa-trash" aria-hidden="true"></i></span>\n                <span>Delete</span>\n              </button>\n            </div>\n            <div class="level-item">\n              <button class="button is-primary is-small button--editLotType" type="button">\n                <span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>\n                <span>Edit ${t.escapedAliases.Lot} Type</span>\n              </button>\n            </div>\n            <div class="level-item">\n              <button class="button is-success is-small button--addLotTypeField" type="button">\n                <span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span>\n                <span>Add Field</span>\n              </button>\n            </div>\n            <div class="level-item">\n              ${t.getMoveUpDownButtonFieldHTML("button--moveLotTypeUp","button--moveLotTypeDown")}\n            </div>\n          </div>\n        </div>\n        </div>`,v(o,T.lotTypeId,null!==(e=T.lotTypeFields)&&void 0!==e?e:[]),null===(s=o.querySelector(".button--toggleLotTypeFields"))||void 0===s||s.addEventListener("click",i),null===(u=o.querySelector(".button--deleteLotType"))||void 0===u||u.addEventListener("click",d),null===(p=o.querySelector(".button--editLotType"))||void 0===p||p.addEventListener("click",a),null===(y=o.querySelector(".button--addLotTypeField"))||void 0===y||y.addEventListener("click",r),o.querySelector(".button--moveLotTypeUp").addEventListener("click",c),o.querySelector(".button--moveLotTypeDown").addEventListener("click",c),l.append(o)}else l.insertAdjacentHTML("afterbegin",`<div class="message is-warning>\n          <p class="message-body">There are no active ${t.escapedAliases.lot} types.</p>\n          </div>`)}null===(e=document.querySelector("#button--addLotType"))||void 0===e||e.addEventListener("click",()=>{let e;function l(l){l.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/admin/doAddLotType`,l.currentTarget,l=>{var n;const i=l;i.success?(e(),o=i.lotTypes,T()):bulmaJS.alert({title:`Error Adding ${t.escapedAliases.Lot} Type`,message:null!==(n=i.errorMessage)&&void 0!==n?n:"",contextualColorName:"danger"})})}cityssm.openHtmlModal("adminLotTypes-addLotType",{onshow(e){t.populateAliases(e)},onshown(t,o){var n;e=o,t.querySelector("#lotTypeAdd--lotType").focus(),null===(n=t.querySelector("form"))||void 0===n||n.addEventListener("submit",l),bulmaJS.toggleHtmlClipped()},onremoved(){bulmaJS.toggleHtmlClipped()}})}),T()})();