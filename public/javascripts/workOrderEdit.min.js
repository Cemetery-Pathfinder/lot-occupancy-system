"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=document.querySelector("main").dataset.urlPrefix,e=document.querySelector("#workOrderEdit--workOrderId").value,s=""===e;if(document.querySelector("#form--workOrderEdit").addEventListener("submit",e=>{e.preventDefault(),cityssm.postJSON(t+"/workOrders/"+(s?"doCreateWorkOrder":"doUpdateWorkOrder"),e.currentTarget,e=>{e.success?s?window.location.href=t+"/workOrders/"+e.workOrderId+"/edit":bulmaJS.alert({message:"Work Order Updated Successfully",contextualColorName:"success"}):bulmaJS.alert({title:"Error Updating Work Order",message:e.errorMessage,contextualColorName:"danger"})})}),!s){let s=exports.workOrderLots;delete exports.workOrderLots;let a=exports.workOrderLotOccupancies;delete exports.workOrderLotOccupancies;const o=s=>{const o=s.currentTarget.closest(".container--lotOccupancy").dataset.lotOccupancyId;bulmaJS.confirm({title:"Delete "+exports.aliases.lot+" "+exports.aliases.occupancy+" Relationship",message:"Are you sure you want to remove the relationship to this "+exports.aliases.lot.toLowerCase()+" "+exports.aliases.occupancy.toLowerCase()+" record from this work order?  Note that the record will remain.",contextualColorName:"warning",okButton:{text:"Yes, Delete Relationship",callbackFunction:()=>{cityssm.postJSON(t+"/workOrders/doDeleteWorkOrderLotOccupancy",{workOrderId:e,lotOccupancyId:o},t=>{t.success?(a=t.workOrderLotOccupancies,n()):bulmaJS.alert({title:"Error Deleting Relationship",message:t.errorMessage,contextualColorName:"danger"})})}}})},r=()=>{const e=document.querySelector("#relatedTab--lotOccupancies");if(document.querySelector(".tabs a[href='#relatedTab--lotOccupancies'] .tag").textContent=a.length.toString(),0===a.length)return void(e.innerHTML='<div class="message is-info"><p class="message-body">There are no '+exports.aliases.occupancies.toLowerCase()+" associated with this work order.</p></div>");e.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th class="has-width-1"></th><th>'+exports.aliases.occupancy+" Type</th><th>"+exports.aliases.lot+"</th><th>Start Date</th><th>End Date</th><th>"+exports.aliases.occupants+'</th><th class="has-width-1"></th></tr></thead><tbody></tbody></table>';const s=cityssm.dateToString(new Date);for(const r of a){const a=document.createElement("tr");a.className="container--lotOccupancy",a.dataset.lotOccupancyId=r.lotOccupancyId.toString();const c=!(r.occupancyEndDate&&r.occupancyEndDateString<s);a.innerHTML='<td class="has-text-centered">'+(c?'<i class="fas fa-play" title="Current '+cityssm.escapeHTML(exports.aliases.occupancy)+'"></i>':'<i class="fas fa-stop" title="Previous '+cityssm.escapeHTML(exports.aliases.occupancy)+'"></i>')+'</td><td><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(t)+"/lotOccupancies/"+r.lotOccupancyId+'">'+cityssm.escapeHTML(r.occupancyType)+"</a></td><td>"+(r.lotId?cityssm.escapeHTML(r.lotName):'<span class="has-text-grey">(No '+exports.aliases.lot+")</span>")+"</td><td>"+r.occupancyStartDateString+"</td><td>"+(r.occupancyEndDate?r.occupancyEndDateString:'<span class="has-text-grey">(No End Date)</span>')+"</td><td>"+(0===r.lotOccupancyOccupants.length?'<span class="has-text-grey">(No '+cityssm.escapeHTML(exports.aliases.occupants)+")</span>":cityssm.escapeHTML(r.lotOccupancyOccupants[0].occupantName)+(r.lotOccupancyOccupants.length>1?" plus "+(r.lotOccupancyOccupants.length-1):""))+'</td><td><button class="button is-small is-light is-danger button--deleteLotOccupancy" data-tooltip="Delete Relationship" type="button"><i class="fas fa-trash" aria-hidden="true"></i></button></td>',a.querySelector(".button--deleteLotOccupancy").addEventListener("click",o),e.querySelector("tbody").append(a)}},c=a=>{const o=a.currentTarget.closest(".container--lot").dataset.lotId;bulmaJS.confirm({title:"Delete "+exports.aliases.lot+" "+exports.aliases.occupancy+" Relationship",message:"Are you sure you want to remove the relationship to this "+exports.aliases.lot.toLowerCase()+" "+exports.aliases.occupancy.toLowerCase()+" record from this work order?  Note that the record will remain.",contextualColorName:"warning",okButton:{text:"Yes, Delete Relationship",callbackFunction:()=>{cityssm.postJSON(t+"/workOrders/doDeleteWorkOrderLot",{workOrderId:e,lotId:o},t=>{t.success?(s=t.workOrderLots,n()):bulmaJS.alert({title:"Error Deleting Relationship",message:t.errorMessage,contextualColorName:"danger"})})}}})},l=()=>{const e=document.querySelector("#relatedTab--lots");if(document.querySelector(".tabs a[href='#relatedTab--lots'] .tag").textContent=s.length.toString(),0!==s.length){e.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th>'+exports.aliases.lot+"</th><th>"+exports.aliases.map+"</th><th>"+exports.aliases.lot+' Type</th><th>Status</th><th class="has-width-1"></th></tr></thead><tbody></tbody></table>';for(const a of s){const s=document.createElement("tr");s.className="container--lot",s.dataset.lotId=a.lotId.toString(),s.innerHTML='<td><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(t)+"/lots/"+a.lotId+'">'+cityssm.escapeHTML(a.lotName)+"</a></td><td>"+cityssm.escapeHTML(a.mapName)+"</td><td>"+cityssm.escapeHTML(a.lotType)+"</td><td>"+cityssm.escapeHTML(a.lotStatus)+'</td><td><button class="button is-small is-light is-danger button--deleteLot" data-tooltip="Delete Relationship" type="button"><i class="fas fa-trash" aria-hidden="true"></i></button></td>',s.querySelector(".button--deleteLot").addEventListener("click",c),e.querySelector("tbody").append(s)}}else e.innerHTML='<div class="message is-info"><p class="message-body">There are no '+exports.aliases.lots.toLowerCase()+" associated with this work order.</p></div>"},n=()=>{r(),l()};n()}})();