"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.los,t=document.querySelector("#lotOccupancy--lotOccupancyId").value,c=""===t;let a=!1,o=c;const n=()=>{a||(a=!0,cityssm.enableNavBlocker())},s=document.querySelector("#form--lotOccupancy");s.addEventListener("submit",t=>{t.preventDefault(),cityssm.postJSON(e.urlPrefix+"/lotOccupancies/"+(c?"doCreateLotOccupancy":"doUpdateLotOccupancy"),s,t=>{t.success?(a=!1,cityssm.disableNavBlocker(),c||o?window.location.href=e.urlPrefix+"/lotOccupancies/"+t.lotOccupancyId+"/edit?t="+Date.now():bulmaJS.alert({message:exports.aliases.occupancy+" Updated Successfully",contextualColorName:"success"})):bulmaJS.alert({title:"Error Saving "+exports.aliases.occupancy,message:t.errorMessage||"",contextualColorName:"danger"})})});const l=s.querySelectorAll("input, select");for(const e of l)e.addEventListener("change",n);if(!c){const c=()=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doCopyLotOccupancy",{lotOccupancyId:t},t=>{var c;t.success?(cityssm.disableNavBlocker(),window.location.href=e.urlPrefix+"/lotOccupancies/"+(null===(c=t.lotOccupancyId)||void 0===c?void 0:c.toString())+"/edit"):bulmaJS.alert({title:"Error Copying Record",message:t.errorMessage||"",contextualColorName:"danger"})})};document.querySelector("#button--copyLotOccupancy").addEventListener("click",e=>{e.preventDefault(),a?bulmaJS.alert({title:"Unsaved Changes",message:"Please save all unsaved changes before continuing.",contextualColorName:"warning"}):bulmaJS.confirm({title:"Copy "+exports.aliases.occupancy+" Record as New",message:"Are you sure you want to copy this record to a new record?",contextualColorName:"info",okButton:{text:"Yes, Copy",callbackFunction:c}})}),document.querySelector("#button--deleteLotOccupancy").addEventListener("click",c=>{c.preventDefault();bulmaJS.confirm({title:"Delete "+exports.aliases.occupancy+" Record",message:"Are you sure you want to delete this record?",contextualColorName:"warning",okButton:{text:"Yes, Delete",callbackFunction:()=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doDeleteLotOccupancy",{lotOccupancyId:t},t=>{t.success?(cityssm.disableNavBlocker(),window.location.href=e.urlPrefix+"/lotOccupancies?t="+Date.now()):bulmaJS.alert({title:"Error Deleting Record",message:t.errorMessage||"",contextualColorName:"danger"})})}}})})}const r=document.querySelector("#lotOccupancy--occupancyTypeId");if(c){const t=document.querySelector("#container--lotOccupancyFields");r.addEventListener("change",()=>{""!==r.value?cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doGetOccupancyTypeFields",{occupancyTypeId:r.value},e=>{if(0===e.occupancyTypeFields.length)return void(t.innerHTML='<div class="message is-info"><p class="message-body">There are no additional fields for this '+exports.aliases.occupancy.toLowerCase()+" type.</p></div>");t.innerHTML="";let c="";for(const a of e.occupancyTypeFields){c+=","+a.occupancyTypeFieldId;const e="lotOccupancyFieldValue_"+a.occupancyTypeFieldId,o="lotOccupancy--"+e,n=document.createElement("div");if(n.className="field",n.innerHTML='<label class="label" for="'+o+'"></label><div class="control"></div>',n.querySelector("label").textContent=a.occupancyTypeField,""===a.occupancyTypeFieldValues){const t=document.createElement("input");t.className="input",t.id=o,t.name=e,t.type="text",t.required=a.isRequired,t.minLength=a.minimumLength,t.maxLength=a.maximumLength,a.pattern&&""!==a.pattern&&(t.pattern=a.pattern),n.querySelector(".control").append(t)}else{n.querySelector(".control").innerHTML='<div class="select is-fullwidth"><select id="'+o+'" name="'+e+'"><option value="">(Not Set)</option></select></div>';const t=n.querySelector("select");t.required=a.isRequired;const c=a.occupancyTypeFieldValues.split("\n");for(const e of c){const c=document.createElement("option");c.value=e,c.textContent=e,t.append(c)}}t.append(n)}t.insertAdjacentHTML("beforeend",'<input name="occupancyTypeFieldIds" type="hidden" value="'+c.slice(1)+'" />')}):t.innerHTML='<div class="message is-info"><p class="message-body">Select the '+exports.aliases.occupancy.toLowerCase()+" type to load the available fields.</p></div>"})}else{const e=r.value;r.addEventListener("change",()=>{r.value!==e&&bulmaJS.confirm({title:"Confirm Change",message:"Are you sure you want to change the "+exports.aliases.occupancy.toLowerCase()+" type?\nThis change affects the additional fields associated with this record, and may also affect the available fees.",contextualColorName:"warning",okButton:{text:"Yes, Keep the Change",callbackFunction:()=>{o=!0}},cancelButton:{text:"Revert the Change",callbackFunction:()=>{r.value=e}}})})}const i=document.querySelector("#lotOccupancy--lotName");if(i.addEventListener("click",t=>{const c=t.currentTarget.value;let a,o,s,l;const r=(e,t)=>{document.querySelector("#lotOccupancy--lotId").value=e.toString(),document.querySelector("#lotOccupancy--lotName").value=t,n(),a()},i=e=>{e.preventDefault();const t=e.currentTarget;r(t.dataset.lotId,t.dataset.lotName)},u=()=>{l.innerHTML='<p class="has-text-centered"><i class="fas fa-3x fa-pulse fa-spinner" aria-hidden="true"></i><br />Searching...</p>',cityssm.postJSON(e.urlPrefix+"/lots/doSearchLots",s,e=>{if(0===e.count)return void(l.innerHTML='<div class="message is-info"><p class="message-body">No results.</p></div>');const t=document.createElement("div");t.className="panel";for(const c of e.lots){const e=document.createElement("a");e.className="panel-block is-block",e.href="#",e.dataset.lotId=c.lotId.toString(),e.dataset.lotName=c.lotName,e.innerHTML='<div class="columns"><div class="column">'+cityssm.escapeHTML(c.lotName||"")+'<br /><span class="is-size-7">'+cityssm.escapeHTML(c.mapName||"")+'</span></div><div class="column">'+cityssm.escapeHTML(c.lotStatus)+'<br /><span class="is-size-7">'+(c.lotOccupancyCount>0?"Currently Occupied":"")+"</span></div></div>",e.addEventListener("click",i),t.append(e)}l.innerHTML="",l.append(t)})},d=t=>{t.preventDefault();const c=o.querySelector("#lotCreate--lotName").value;cityssm.postJSON(e.urlPrefix+"/lots/doCreateLot",t.currentTarget,e=>{e.success?r(e.lotId,c):bulmaJS.alert({title:"Error Creating "+exports.aliases.lot,message:e.errorMessage||"",contextualColorName:"danger"})})};cityssm.openHtmlModal("lotOccupancy-selectLot",{onshow:t=>{e.populateAliases(t)},onshown:(e,t)=>{bulmaJS.toggleHtmlClipped(),o=e,a=t,bulmaJS.init(e);const n=e.querySelector("#lotSelect--lotName");""!==document.querySelector("#lotOccupancy--lotId").value&&(n.value=c),n.focus(),n.addEventListener("change",u);const r=e.querySelector("#lotSelect--occupancyStatus");if(r.addEventListener("change",u),""!==c&&(r.value=""),s=e.querySelector("#form--lotSelect"),l=e.querySelector("#resultsContainer--lotSelect"),s.addEventListener("submit",e=>{e.preventDefault()}),u(),exports.lotNamePattern){const t=exports.lotNamePattern;e.querySelector("#lotCreate--lotName").pattern=t.source}const i=e.querySelector("#lotCreate--lotTypeId");for(const e of exports.lotTypes){const t=document.createElement("option");t.value=e.lotTypeId.toString(),t.textContent=e.lotType,i.append(t)}const p=e.querySelector("#lotCreate--lotStatusId");for(const e of exports.lotStatuses){const t=document.createElement("option");t.value=e.lotStatusId.toString(),t.textContent=e.lotStatus,p.append(t)}const m=e.querySelector("#lotCreate--mapId");for(const e of exports.maps){const t=document.createElement("option");t.value=e.mapId.toString(),t.textContent=e.mapName||"(No Name)",m.append(t)}e.querySelector("#form--lotCreate").addEventListener("submit",d)},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})}),document.querySelector(".is-lot-view-button").addEventListener("click",()=>{const t=document.querySelector("#lotOccupancy--lotId").value;t?window.open(e.urlPrefix+"/lots/"+t):bulmaJS.alert({message:"No "+exports.aliases.lot.toLowerCase()+" selected.",contextualColorName:"info"})}),document.querySelector(".is-clear-lot-button").addEventListener("click",()=>{i.disabled?bulmaJS.alert({message:"You need to unlock the field before clearing it.",contextualColorName:"info"}):(i.value="(No "+exports.aliases.lot+")",document.querySelector("#lotOccupancy--lotId").value="",n())}),e.initializeDatePickers(s),document.querySelector("#lotOccupancy--occupancyStartDateString").addEventListener("change",()=>{const e=document.querySelector("#lotOccupancy--occupancyEndDateString").bulmaCalendar.datePicker;e.min=document.querySelector("#lotOccupancy--occupancyStartDateString").value,e.refresh()}),e.initializeUnlockFieldButtons(s),!c){let c=exports.lotOccupancyOccupants;delete exports.lotOccupancyOccupants;const a=a=>{const o=Number.parseInt(a.currentTarget.closest("tr").dataset.lotOccupantIndex,10),s=c.find(e=>e.lotOccupantIndex===o);let l,r;const i=t=>{t.preventDefault(),cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doUpdateLotOccupancyOccupant",l,e=>{e.success?(c=e.lotOccupancyOccupants,r(),n()):bulmaJS.alert({title:"Error Updating "+exports.aliases.occupant,message:e.errorMessage||"",contextualColorName:"danger"})})};cityssm.openHtmlModal("lotOccupancy-editOccupant",{onshow:c=>{e.populateAliases(c),c.querySelector("#lotOccupancyOccupantEdit--lotOccupancyId").value=t,c.querySelector("#lotOccupancyOccupantEdit--lotOccupantIndex").value=o.toString();const a=c.querySelector("#lotOccupancyOccupantEdit--lotOccupantTypeId");let n=!1;for(const e of exports.lotOccupantTypes){const t=document.createElement("option");t.value=e.lotOccupantTypeId.toString(),t.textContent=e.lotOccupantType,e.lotOccupantTypeId===s.lotOccupantTypeId&&(t.selected=!0,n=!0),a.append(t)}if(!n){const e=document.createElement("option");e.value=s.lotOccupantTypeId.toString(),e.textContent=s.lotOccupantType,e.selected=!0,a.append(e)}c.querySelector("#lotOccupancyOccupantEdit--occupantName").value=s.occupantName,c.querySelector("#lotOccupancyOccupantEdit--occupantAddress1").value=s.occupantAddress1,c.querySelector("#lotOccupancyOccupantEdit--occupantAddress2").value=s.occupantAddress2,c.querySelector("#lotOccupancyOccupantEdit--occupantCity").value=s.occupantCity,c.querySelector("#lotOccupancyOccupantEdit--occupantProvince").value=s.occupantProvince,c.querySelector("#lotOccupancyOccupantEdit--occupantPostalCode").value=s.occupantPostalCode,c.querySelector("#lotOccupancyOccupantEdit--occupantPhoneNumber").value=s.occupantPhoneNumber,c.querySelector("#lotOccupancyOccupantEdit--occupantEmailAddress").value=s.occupantEmailAddress},onshown:(e,t)=>{bulmaJS.toggleHtmlClipped(),e.querySelector("#lotOccupancyOccupantEdit--lotOccupantTypeId").focus(),(l=e.querySelector("form")).addEventListener("submit",i),r=t},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})},o=a=>{const o=a.currentTarget.closest("tr").dataset.lotOccupantIndex;bulmaJS.confirm({title:"Remove "+exports.aliases.occupant+"?",message:"Are you sure you want to remove this "+exports.aliases.occupant.toLowerCase()+"?",okButton:{text:"Yes, Remove "+exports.aliases.occupant,callbackFunction:()=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyOccupant",{lotOccupancyId:t,lotOccupantIndex:o},e=>{e.success?(c=e.lotOccupancyOccupants,n()):bulmaJS.alert({title:"Error Removing "+exports.aliases.occupant,message:e.errorMessage||"",contextualColorName:"danger"})})}},contextualColorName:"warning"})},n=()=>{const e=document.querySelector("#container--lotOccupancyOccupants");if(cityssm.clearElement(e),0===c.length)return void(e.innerHTML='<div class="message is-warning"><p class="message-body">There are no '+exports.aliases.occupants.toLowerCase()+" associated with this record.</p></div>");const t=document.createElement("table");t.className="table is-fullwidth is-striped is-hoverable",t.innerHTML="<thead><tr><th>"+exports.aliases.occupant+" Type</th><th>"+exports.aliases.occupant+'</th><th>Address</th><th>Other Contact</th><th class="is-hidden-print"><span class="is-sr-only">Options</span></th></tr></thead><tbody></tbody>';for(const e of c){const c=document.createElement("tr");c.dataset.lotOccupantIndex=e.lotOccupantIndex.toString(),c.innerHTML="<td>"+cityssm.escapeHTML(e.lotOccupantType)+"</td><td>"+cityssm.escapeHTML(e.occupantName||"")+"</td><td>"+(e.occupantAddress1?cityssm.escapeHTML(e.occupantAddress1)+"<br />":"")+(e.occupantAddress2?cityssm.escapeHTML(e.occupantAddress2)+"<br />":"")+(e.occupantCity?cityssm.escapeHTML(e.occupantCity)+", ":"")+cityssm.escapeHTML(e.occupantProvince||"")+"<br />"+cityssm.escapeHTML(e.occupantPostalCode||"")+"</td><td>"+(e.occupantPhoneNumber?cityssm.escapeHTML(e.occupantPhoneNumber)+"<br />":"")+(e.occupantEmailAddress?cityssm.escapeHTML(e.occupantEmailAddress):"")+'</td><td class="is-hidden-print"><div class="buttons are-small is-justify-content-end"><button class="button is-primary button--edit" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-light is-danger button--delete" data-tooltip="Delete '+cityssm.escapeHTML(exports.aliases.occupant)+'" type="button" aria-label="Delete"><i class="fas fa-trash" aria-hidden="true"></i></button></div></td>',c.querySelector(".button--edit").addEventListener("click",a),c.querySelector(".button--delete").addEventListener("click",o),t.querySelector("tbody").append(c)}e.append(t)};document.querySelector("#button--addOccupant").addEventListener("click",()=>{let a,o,s,l;const r=t=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doAddLotOccupancyOccupant",t,e=>{e.success?(c=e.lotOccupancyOccupants,a(),n()):bulmaJS.alert({title:"Error Adding "+exports.aliases.occupant,message:e.errorMessage||"",contextualColorName:"danger"})})},i=e=>{e.preventDefault(),r(o)};let u=[];const d=e=>{e.preventDefault();const c=e.currentTarget,a=u[Number.parseInt(c.dataset.index,10)],o=c.closest(".modal").querySelector("#lotOccupancyOccupantCopy--lotOccupantTypeId").value;""===o?bulmaJS.alert({title:"No "+exports.aliases.occupant+" Type Selected",message:"Select a type to apply to the newly added "+exports.aliases.occupant.toLowerCase()+".",contextualColorName:"warning"}):(a.lotOccupantTypeId=Number.parseInt(o,10),a.lotOccupancyId=Number.parseInt(t,10),r(a))},p=t=>{t.preventDefault(),""!==s.querySelector("#lotOccupancyOccupantCopy--searchFilter").value?(l.innerHTML='<div class="has-text-grey has-text-centered"><i class="fas fa-5x fa-circle-notch fa-spin" aria-hidden="true"></i><br />Searching...</div>',cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doSearchPastOccupants",s,e=>{u=e.occupants;const t=document.createElement("div");t.className="panel";for(const[e,c]of u.entries()){const a=document.createElement("a");a.className="panel-block is-block",a.dataset.index=e.toString(),a.innerHTML="<strong>"+cityssm.escapeHTML(c.occupantName||"")+'</strong><br /><div class="columns"><div class="column">'+cityssm.escapeHTML(c.occupantAddress1||"")+"<br />"+(c.occupantAddress2?cityssm.escapeHTML(c.occupantAddress2)+"<br />":"")+cityssm.escapeHTML(c.occupantCity||"")+", "+cityssm.escapeHTML(c.occupantProvince||"")+"<br />"+cityssm.escapeHTML(c.occupantPostalCode||"")+'</div><div class="column">'+(c.occupantPhoneNumber?cityssm.escapeHTML(c.occupantPhoneNumber)+"<br />":"")+cityssm.escapeHTML(c.occupantEmailAddress||"")+"<br /></div></div>",a.addEventListener("click",d),t.append(a)}l.innerHTML="",l.append(t)})):l.innerHTML='<div class="message is-info"><p class="message-body">Enter a partial name or address in the search field above.</p></div>'};cityssm.openHtmlModal("lotOccupancy-addOccupant",{onshow:c=>{e.populateAliases(c),c.querySelector("#lotOccupancyOccupantAdd--lotOccupancyId").value=t;const a=c.querySelector("#lotOccupancyOccupantAdd--lotOccupantTypeId"),o=c.querySelector("#lotOccupancyOccupantCopy--lotOccupantTypeId");for(const e of exports.lotOccupantTypes){const t=document.createElement("option");t.value=e.lotOccupantTypeId.toString(),t.textContent=e.lotOccupantType,a.append(t),o.append(t.cloneNode(!0))}c.querySelector("#lotOccupancyOccupantAdd--occupantCity").value=exports.occupantCityDefault,c.querySelector("#lotOccupancyOccupantAdd--occupantProvince").value=exports.occupantProvinceDefault},onshown:(e,t)=>{bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),e.querySelector("#lotOccupancyOccupantAdd--lotOccupantTypeId").focus(),(o=e.querySelector("#form--lotOccupancyOccupantAdd")).addEventListener("submit",i),l=e.querySelector("#lotOccupancyOccupantCopy--searchResults"),(s=e.querySelector("#form--lotOccupancyOccupantCopy")).addEventListener("submit",e=>{e.preventDefault()}),e.querySelector("#lotOccupancyOccupantCopy--searchFilter").addEventListener("change",p),a=t},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})}),n()}if(!c){let c=exports.lotOccupancyComments;delete exports.lotOccupancyComments;const a=a=>{const o=Number.parseInt(a.currentTarget.closest("tr").dataset.lotOccupancyCommentId,10),s=c.find(e=>e.lotOccupancyCommentId===o);let l,r;const i=t=>{t.preventDefault(),cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doUpdateLotOccupancyComment",l,e=>{e.success?(c=e.lotOccupancyComments,r(),n()):bulmaJS.alert({title:"Error Updating Comment",message:e.errorMessage||"",contextualColorName:"danger"})})};cityssm.openHtmlModal("lotOccupancy-editComment",{onshow:c=>{e.populateAliases(c),c.querySelector("#lotOccupancyCommentEdit--lotOccupancyId").value=t,c.querySelector("#lotOccupancyCommentEdit--lotOccupancyCommentId").value=o.toString(),c.querySelector("#lotOccupancyCommentEdit--lotOccupancyComment").value=s.lotOccupancyComment;const a=c.querySelector("#lotOccupancyCommentEdit--lotOccupancyCommentDateString");a.value=s.lotOccupancyCommentDateString;const n=cityssm.dateToString(new Date);a.max=s.lotOccupancyCommentDateString<=n?n:s.lotOccupancyCommentDateString,c.querySelector("#lotOccupancyCommentEdit--lotOccupancyCommentTimeString").value=s.lotOccupancyCommentTimeString},onshown:(t,c)=>{bulmaJS.toggleHtmlClipped(),e.initializeDatePickers(t),e.initializeTimePickers(t),t.querySelector("#lotOccupancyCommentEdit--lotOccupancyComment").focus(),(l=t.querySelector("form")).addEventListener("submit",i),r=c},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})},o=a=>{const o=Number.parseInt(a.currentTarget.closest("tr").dataset.lotOccupancyCommentId,10);bulmaJS.confirm({title:"Remove Comment?",message:"Are you sure you want to remove this comment?",okButton:{text:"Yes, Remove Comment",callbackFunction:()=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyComment",{lotOccupancyId:t,lotOccupancyCommentId:o},e=>{e.success?(c=e.lotOccupancyComments,n()):bulmaJS.alert({title:"Error Removing Comment",message:e.errorMessage||"",contextualColorName:"danger"})})}},contextualColorName:"warning"})},n=()=>{const e=document.querySelector("#container--lotOccupancyComments");if(0===c.length)return void(e.innerHTML='<div class="message is-info"><p class="message-body">There are no comments associated with this record.</p></div>');const t=document.createElement("table");t.className="table is-fullwidth is-striped is-hoverable",t.innerHTML='<thead><tr><th>Commentor</th><th>Comment Date</th><th>Comment</th><th class="is-hidden-print"><span class="is-sr-only">Options</span></th></tr></thead><tbody></tbody>';for(const e of c){const c=document.createElement("tr");c.dataset.lotOccupancyCommentId=e.lotOccupancyCommentId.toString(),c.innerHTML="<td>"+cityssm.escapeHTML(e.recordCreate_userName||"")+"</td><td>"+e.lotOccupancyCommentDateString+(0===e.lotOccupancyCommentTime?"":" "+e.lotOccupancyCommentTimeString)+"</td><td>"+cityssm.escapeHTML(e.lotOccupancyComment||"")+'</td><td class="is-hidden-print"><div class="buttons are-small is-justify-content-end"><button class="button is-primary button--edit" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-light is-danger button--delete" data-tooltip="Delete Comment" type="button" aria-label="Delete"><i class="fas fa-trash" aria-hidden="true"></i></button></div></td>',c.querySelector(".button--edit").addEventListener("click",a),c.querySelector(".button--delete").addEventListener("click",o),t.querySelector("tbody").append(c)}e.innerHTML="",e.append(t)};document.querySelector("#button--addComment").addEventListener("click",()=>{let a,o;const s=t=>{t.preventDefault(),cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doAddLotOccupancyComment",a,e=>{e.success?(c=e.lotOccupancyComments,o(),n()):bulmaJS.alert({title:"Error Adding Comment",message:e.errorMessage||"",contextualColorName:"danger"})})};cityssm.openHtmlModal("lotOccupancy-addComment",{onshow:c=>{e.populateAliases(c),c.querySelector("#lotOccupancyCommentAdd--lotOccupancyId").value=t},onshown:(e,t)=>{bulmaJS.toggleHtmlClipped(),e.querySelector("#lotOccupancyCommentAdd--lotOccupancyComment").focus(),(a=e.querySelector("form")).addEventListener("submit",s),o=t},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})}),n()}if(!c){let c=exports.lotOccupancyFees;delete exports.lotOccupancyFees;const o=document.querySelector("#container--lotOccupancyFees"),n=()=>{let e=0;for(const t of c)e+=(t.feeAmount+t.taxAmount)*t.quantity;return e},s=a=>{const o=a.currentTarget.closest(".container--lotOccupancyFee").dataset.feeId;bulmaJS.confirm({title:"Delete Fee",message:"Are you sure you want to delete this fee?",contextualColorName:"warning",okButton:{text:"Yes, Delete Fee",callbackFunction:()=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyFee",{lotOccupancyId:t,feeId:o},e=>{e.success?(c=e.lotOccupancyFees,l()):bulmaJS.alert({title:"Error Deleting Fee",message:e.errorMessage||"",contextualColorName:"danger"})})}}})},l=()=>{if(0===c.length)return o.innerHTML='<div class="message is-info"><p class="message-body">There are no fees associated with this record.</p></div>',void p();o.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th>Fee</th><th><span class="is-sr-only">Unit Cost</span></th><th class="has-width-1"><span class="is-sr-only">&times;</span></th><th class="has-width-1"><span class="is-sr-only">Quantity</span></th><th class="has-width-1"><span class="is-sr-only">equals</span></th><th class="has-width-1 has-text-right">Total</th><th class="has-width-1 is-hidden-print"><span class="is-sr-only">Options</span></th></tr></thead><tbody></tbody><tfoot><tr><th colspan="5">Subtotal</th><td class="has-text-weight-bold has-text-right" id="lotOccupancyFees--feeAmountTotal"></td><td class="is-hidden-print"></td></tr><tr><th colspan="5">Tax</th><td class="has-text-right" id="lotOccupancyFees--taxAmountTotal"></td><td class="is-hidden-print"></td></tr><tr><th colspan="5">Grand Total</th><td class="has-text-weight-bold has-text-right" id="lotOccupancyFees--grandTotal"></td><td class="is-hidden-print"></td></tr></tfoot></table>';let e=0,t=0;for(const a of c){const c=document.createElement("tr");c.className="container--lotOccupancyFee",c.dataset.feeId=a.feeId.toString(),c.dataset.includeQuantity=a.includeQuantity?"1":"0",c.innerHTML='<td colspan="'+(1===a.quantity?"5":"1")+'">'+cityssm.escapeHTML(a.feeName||"")+"</td>"+(1===a.quantity?"":'<td class="has-text-right">$'+a.feeAmount.toFixed(2)+'</td><td>&times;</td><td class="has-text-right">'+a.quantity+"</td><td>=</td>")+'<td class="has-text-right">$'+(a.feeAmount*a.quantity).toFixed(2)+'</td><td class="is-hidden-print"><button class="button is-small is-danger is-light" data-tooltip="Delete Fee" type="button"><i class="fas fa-trash" aria-hidden="true"></i></button></td>',c.querySelector("button").addEventListener("click",s),o.querySelector("tbody").append(c),e+=a.feeAmount*a.quantity,t+=a.taxAmount*a.quantity}o.querySelector("#lotOccupancyFees--feeAmountTotal").textContent="$"+e.toFixed(2),o.querySelector("#lotOccupancyFees--taxAmountTotal").textContent="$"+t.toFixed(2),o.querySelector("#lotOccupancyFees--grandTotal").textContent="$"+(e+t).toFixed(2),p()};document.querySelector("#button--addFee").addEventListener("click",()=>{if(a)return void bulmaJS.alert({message:"Please save all unsaved changes before adding fees.",contextualColorName:"warning"});let n,s,r;const i=(a,o=1)=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doAddLotOccupancyFee",{lotOccupancyId:t,feeId:a,quantity:o},e=>{e.success?(c=e.lotOccupancyFees,l(),d()):bulmaJS.alert({title:"Error Adding Fee",message:e.errorMessage||"",contextualColorName:"danger"})})},u=e=>{e.preventDefault();const t=Number.parseInt(e.currentTarget.dataset.feeId,10),c=Number.parseInt(e.currentTarget.closest(".container--feeCategory").dataset.feeCategoryId,10),a=n.find(e=>e.feeCategoryId===c).fees.find(e=>e.feeId===t);a.includeQuantity?(e=>{let t,c;const a=a=>{a.preventDefault(),i(e.feeId,t.value),c()};cityssm.openHtmlModal("lotOccupancy-setFeeQuantity",{onshow:t=>{t.querySelector("#lotOccupancyFeeQuantity--quantityUnit").textContent=e.quantityUnit},onshown:(e,o)=>{c=o,t=e.querySelector("#lotOccupancyFeeQuantity--quantity"),e.querySelector("form").addEventListener("submit",a)}})})(a):i(t)},d=()=>{const e=s.value.trim().toLowerCase().split(" ");r.innerHTML="";for(const t of n){const c=document.createElement("div");c.className="container--feeCategory",c.dataset.feeCategoryId=t.feeCategoryId.toString(),c.innerHTML='<h4 class="title is-5 mt-2">'+cityssm.escapeHTML(t.feeCategory||"")+'</h4><div class="panel mb-5"></div>';let a=!1;for(const n of t.fees){if(o.querySelector(".container--lotOccupancyFee[data-fee-id='"+n.feeId+"'][data-include-quantity='0']"))continue;let t=!0;for(const c of e)if(!n.feeName.toLowerCase().includes(c)){t=!1;break}if(!t)continue;a=!0;const s=document.createElement("a");s.className="panel-block is-block container--fee",s.dataset.feeId=n.feeId.toString(),s.href="#",s.innerHTML="<strong>"+cityssm.escapeHTML(n.feeName||"")+"</strong><br /><small>"+cityssm.escapeHTML(n.feeDescription||"").replace(/\n/g,"<br />")+"</small>",s.addEventListener("click",u),c.querySelector(".panel").append(s)}a&&r.append(c)}};cityssm.openHtmlModal("lotOccupancy-addFee",{onshow:c=>{s=c.querySelector("#feeSelect--feeName"),r=c.querySelector("#resultsContainer--feeSelect"),cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doGetFees",{lotOccupancyId:t},e=>{n=e.feeCategories,s.disabled=!1,s.addEventListener("keyup",d),s.focus(),d()})},onshown:()=>{bulmaJS.toggleHtmlClipped()},onhidden:()=>{l()},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})});let r=exports.lotOccupancyTransactions;delete exports.lotOccupancyTransactions;const i=document.querySelector("#container--lotOccupancyTransactions"),u=()=>{let e=0;for(const t of r)e+=t.transactionAmount;return e},d=c=>{const a=c.currentTarget.closest(".container--lotOccupancyTransaction").dataset.transactionIndex;bulmaJS.confirm({title:"Delete Trasnaction",message:"Are you sure you want to delete this transaction?",contextualColorName:"warning",okButton:{text:"Yes, Delete Transaction",callbackFunction:()=>{cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyTransaction",{lotOccupancyId:t,transactionIndex:a},e=>{e.success?(r=e.lotOccupancyTransactions,p()):bulmaJS.alert({title:"Error Deleting Transaction",message:e.errorMessage||"",contextualColorName:"danger"})})}}})},p=()=>{if(0===r.length)return void(i.innerHTML='<div class="message '+(0===c.length?"is-info":"is-warning")+'"><p class="message-body">There are no transactions associated with this record.</p></div>');i.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th class="has-width-1">Date</th><th>'+cityssm.escapeHTML(exports.aliases.externalReceiptNumber)+'</th><th class="has-text-right has-width-1">Amount</th><th class="has-width-1 is-hidden-print"><span class="is-sr-only">Options</span></th></tr></thead><tbody></tbody><tfoot><tr><th colspan="2">Transaction Total</th><td class="has-text-weight-bold has-text-right" id="lotOccupancyTransactions--grandTotal"></td><td class="is-hidden-print"></td></tr></tfoot></table>';let e=0;for(const t of r){e+=t.transactionAmount;const c=document.createElement("tr");c.className="container--lotOccupancyTransaction",c.dataset.transactionIndex=t.transactionIndex.toString(),c.innerHTML="<td>"+t.transactionDateString+"</td><td>"+cityssm.escapeHTML(t.externalReceiptNumber||"")+"<br /><small>"+cityssm.escapeHTML(t.transactionNote||"")+'</small></td><td class="has-text-right">$'+t.transactionAmount.toFixed(2)+'</td><td class="is-hidden-print"><button class="button is-small is-danger is-light" data-tooltip="Delete Transaction" type="button"><i class="fas fa-trash" aria-hidden="true"></i></button></td>',c.querySelector("button").addEventListener("click",d),i.querySelector("tbody").append(c)}i.querySelector("#lotOccupancyTransactions--grandTotal").textContent="$"+e.toFixed(2);const t=n();t>e&&i.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body"><div class="level"><div class="level-left"><div class="level-item">Outstanding Balance</div></div><div class="level-right"><div class="level-item">$'+(t-e).toFixed(2)+"</div></div></div></div></div>")};document.querySelector("#button--addTransaction").addEventListener("click",()=>{let c;const a=t=>{t.preventDefault(),cityssm.postJSON(e.urlPrefix+"/lotOccupancies/doAddLotOccupancyTransaction",t.currentTarget,e=>{e.success?(r=e.lotOccupancyTransactions,c(),p()):bulmaJS.confirm({title:"Error Adding Transaction",message:e.errorMessage||"",contextualColorName:"danger"})})};cityssm.openHtmlModal("lotOccupancy-addTransaction",{onshow:c=>{e.populateAliases(c),c.querySelector("#lotOccupancyTransactionAdd--lotOccupancyId").value=t.toString();const a=n(),o=u(),s=c.querySelector("#lotOccupancyTransactionAdd--transactionAmount");s.min=(-1*o).toFixed(2),s.max=Math.max(a-o,0).toFixed(2),s.value=Math.max(a-o,0).toFixed(2)},onshown:(e,t)=>{bulmaJS.toggleHtmlClipped(),c=t,e.querySelector("form").addEventListener("submit",a)},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})}),l()}})();