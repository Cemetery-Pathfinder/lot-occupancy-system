"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,c,n,a;const o=exports.los,s=document.querySelector("#lotOccupancy--lotOccupancyId").value,l=""===s;let r=l;function i(){var e;o.setUnsavedChanges(),null===(e=document.querySelector("button[type='submit'][form='form--lotOccupancy']"))||void 0===e||e.classList.remove("is-light")}function u(){var e;o.clearUnsavedChanges(),null===(e=document.querySelector("button[type='submit'][form='form--lotOccupancy']"))||void 0===e||e.classList.add("is-light")}const d=document.querySelector("#form--lotOccupancy");d.addEventListener("submit",e=>{e.preventDefault(),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/"+(l?"doCreateLotOccupancy":"doUpdateLotOccupancy"),d,e=>{var t;const c=e;c.success?(u(),l||r?window.location.href=o.getLotOccupancyURL(c.lotOccupancyId,!0,!0):bulmaJS.alert({message:`${o.escapedAliases.Occupancy} Updated Successfully`,contextualColorName:"success"})):bulmaJS.alert({title:"Error Saving "+o.escapedAliases.Occupancy,message:null!==(t=c.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})});const p=d.querySelectorAll("input, select");for(const e of p)e.addEventListener("change",i);function m(){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doCopyLotOccupancy",{lotOccupancyId:s},e=>{var t;const c=e;c.success?(u(),window.location.href=o.getLotOccupancyURL(c.lotOccupancyId,!0)):bulmaJS.alert({title:"Error Copying Record",message:null!==(t=c.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}null===(S=document.querySelector("#button--copyLotOccupancy"))||void 0===S||S.addEventListener("click",e=>{e.preventDefault(),o.hasUnsavedChanges()?bulmaJS.alert({title:"Unsaved Changes",message:"Please save all unsaved changes before continuing.",contextualColorName:"warning"}):bulmaJS.confirm({title:`Copy ${o.escapedAliases.Occupancy} Record as New`,message:"Are you sure you want to copy this record to a new record?",contextualColorName:"info",okButton:{text:"Yes, Copy",callbackFunction:m}})}),null===(e=document.querySelector("#button--deleteLotOccupancy"))||void 0===e||e.addEventListener("click",e=>{e.preventDefault(),bulmaJS.confirm({title:`Delete ${o.escapedAliases.Occupancy} Record`,message:"Are you sure you want to delete this record?",contextualColorName:"warning",okButton:{text:"Yes, Delete",callbackFunction:function(){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doDeleteLotOccupancy",{lotOccupancyId:s},e=>{var t;const c=e;c.success?(u(),window.location.href=o.getLotOccupancyURL()):bulmaJS.alert({title:"Error Deleting Record",message:null!==(t=c.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}}})}),null===(t=document.querySelector("#button--createWorkOrder"))||void 0===t||t.addEventListener("click",e=>{let t;function c(e){e.preventDefault(),cityssm.postJSON(o.urlPrefix+"/workOrders/doCreateWorkOrder",e.currentTarget,e=>{const c=e;c.success?(t(),bulmaJS.confirm({title:"Work Order Created Successfully",message:"Would you like to open the work order now?",contextualColorName:"success",okButton:{text:"Yes, Open the Work Order",callbackFunction:()=>{window.location.href=o.getWorkOrderURL(c.workOrderId,!0)}}})):bulmaJS.alert({title:"Error Creating Work Order",message:c.errorMessage,contextualColorName:"danger"})})}e.preventDefault(),cityssm.openHtmlModal("lotOccupancy-createWorkOrder",{onshow(e){var t;e.querySelector("#workOrderCreate--lotOccupancyId").value=s,e.querySelector("#workOrderCreate--workOrderOpenDateString").value=cityssm.dateToString(new Date);const c=e.querySelector("#workOrderCreate--workOrderTypeId"),n=exports.workOrderTypes;1===n.length&&(c.innerHTML="");for(const e of n){const n=document.createElement("option");n.value=e.workOrderTypeId.toString(),n.textContent=null!==(t=e.workOrderType)&&void 0!==t?t:"",c.append(n)}},onshown(e,n){var a;t=n,bulmaJS.toggleHtmlClipped(),e.querySelector("#workOrderCreate--workOrderTypeId").focus(),null===(a=e.querySelector("form"))||void 0===a||a.addEventListener("submit",c)},onremoved(){bulmaJS.toggleHtmlClipped(),document.querySelector("#button--createWorkOrder").focus()}})});const y=document.querySelector("#lotOccupancy--occupancyTypeId");if(l){const e=document.querySelector("#container--lotOccupancyFields");y.addEventListener("change",()=>{""!==y.value?cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doGetOccupancyTypeFields",{occupancyTypeId:y.value},t=>{var c,n;const a=t;if(0===a.occupancyTypeFields.length)return void(e.innerHTML=`<div class="message is-info">\n              <p class="message-body">There are no additional fields for this ${o.escapedAliases.occupancy} type.</p>\n              </div>`);e.innerHTML="";let s="";for(const t of a.occupancyTypeFields){s+=","+t.occupancyTypeFieldId.toString();const a="lotOccupancyFieldValue_"+t.occupancyTypeFieldId.toString(),o="lotOccupancy--"+a,l=document.createElement("div");if(l.className="field",l.innerHTML=`<label class="label" for="${o}"></label><div class="control"></div>`,l.querySelector("label").textContent=t.occupancyTypeField,""===(null!==(c=t.occupancyTypeFieldValues)&&void 0!==c?c:"")){const e=document.createElement("input");e.className="input",e.id=o,e.name=a,e.type="text",e.required=t.isRequired,e.minLength=t.minimumLength,e.maxLength=t.maximumLength,""!==(null!==(n=t.pattern)&&void 0!==n?n:"")&&(e.pattern=t.pattern),l.querySelector(".control").append(e)}else{l.querySelector(".control").innerHTML=`<div class="select is-fullwidth">\n                  <select id="${o}" name="${a}">\n                  <option value="">(Not Set)</option>\n                  </select>\n                  </div>`;const e=l.querySelector("select");e.required=t.isRequired;const c=t.occupancyTypeFieldValues.split("\n");for(const t of c){const c=document.createElement("option");c.value=t,c.textContent=t,e.append(c)}}console.log(l),e.append(l)}e.insertAdjacentHTML("beforeend",`<input name="occupancyTypeFieldIds" type="hidden" value="${s.slice(1)}" />`)}):e.innerHTML=`<div class="message is-info">\n          <p class="message-body">Select the ${o.escapedAliases.occupancy} type to load the available fields.</p>\n          </div>`})}else{const e=y.value;y.addEventListener("change",()=>{y.value!==e&&bulmaJS.confirm({title:"Confirm Change",message:`Are you sure you want to change the ${o.escapedAliases.occupancy} type?\n\n            This change affects the additional fields associated with this record, and may also affect the available fees.`,contextualColorName:"warning",okButton:{text:"Yes, Keep the Change",callbackFunction:()=>{r=!0}},cancelButton:{text:"Revert the Change",callbackFunction:()=>{y.value=e}}})})}const v=document.querySelector("#lotOccupancy--lotName");v.addEventListener("click",e=>{const t=e.currentTarget.value;let c,n,a,s;function l(e,t){document.querySelector("#lotOccupancy--lotId").value=e.toString(),document.querySelector("#lotOccupancy--lotName").value=t,i(),c()}function r(e){e.preventDefault();const t=e.currentTarget;l(t.dataset.lotId,t.dataset.lotName)}function u(){s.innerHTML=o.getLoadingParagraphHTML("Searching..."),cityssm.postJSON(o.urlPrefix+"/lots/doSearchLots",a,e=>{var t,c;const n=e;if(0===n.count)return void(s.innerHTML='<div class="message is-info">\n              <p class="message-body">No results.</p>\n              </div>');const a=document.createElement("div");a.className="panel";for(const e of n.lots){const n=document.createElement("a");n.className="panel-block is-block",n.href="#",n.dataset.lotId=e.lotId.toString(),n.dataset.lotName=e.lotName,n.innerHTML='<div class="columns"><div class="column">'+cityssm.escapeHTML(null!==(t=e.lotName)&&void 0!==t?t:"")+'<br /><span class="is-size-7">'+cityssm.escapeHTML(null!==(c=e.mapName)&&void 0!==c?c:"")+'</span></div><div class="column">'+cityssm.escapeHTML(e.lotStatus)+'<br /><span class="is-size-7">'+(e.lotOccupancyCount>0?"Currently Occupied":"")+"</span></div></div>",n.addEventListener("click",r),a.append(n)}s.innerHTML="",s.append(a)})}function d(e){e.preventDefault();const t=n.querySelector("#lotCreate--lotName").value;cityssm.postJSON(o.urlPrefix+"/lots/doCreateLot",e.currentTarget,e=>{var c;const n=e;n.success?l(n.lotId,t):bulmaJS.alert({title:`Error Creating ${o.escapedAliases.Lot}`,message:null!==(c=n.errorMessage)&&void 0!==c?c:"",contextualColorName:"danger"})})}cityssm.openHtmlModal("lotOccupancy-selectLot",{onshow(e){o.populateAliases(e)},onshown(e,o){var l;bulmaJS.toggleHtmlClipped(),n=e,c=o,bulmaJS.init(e);const r=e.querySelector("#lotSelect--lotName");""!==document.querySelector("#lotOccupancy--lotId").value&&(r.value=t),r.focus(),r.addEventListener("change",u);const i=e.querySelector("#lotSelect--occupancyStatus");if(i.addEventListener("change",u),""!==t&&(i.value=""),a=e.querySelector("#form--lotSelect"),s=e.querySelector("#resultsContainer--lotSelect"),a.addEventListener("submit",e=>{e.preventDefault()}),u(),exports.lotNamePattern){const t=exports.lotNamePattern;e.querySelector("#lotCreate--lotName").pattern=t.source}const p=e.querySelector("#lotCreate--lotTypeId");for(const e of exports.lotTypes){const t=document.createElement("option");t.value=e.lotTypeId.toString(),t.textContent=e.lotType,p.append(t)}const m=e.querySelector("#lotCreate--lotStatusId");for(const e of exports.lotStatuses){const t=document.createElement("option");t.value=e.lotStatusId.toString(),t.textContent=e.lotStatus,m.append(t)}const y=e.querySelector("#lotCreate--mapId");for(const e of exports.maps){const t=document.createElement("option");t.value=e.mapId.toString(),t.textContent=""===(null!==(l=e.mapName)&&void 0!==l?l:"")?"(No Name)":e.mapName,y.append(t)}e.querySelector("#form--lotCreate").addEventListener("submit",d)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),null===(c=document.querySelector(".is-lot-view-button"))||void 0===c||c.addEventListener("click",()=>{const e=document.querySelector("#lotOccupancy--lotId").value;""===e?bulmaJS.alert({message:`No ${o.escapedAliases.lot} selected.`,contextualColorName:"info"}):window.open(o.urlPrefix+"/lots/"+e)}),null===(n=document.querySelector(".is-clear-lot-button"))||void 0===n||n.addEventListener("click",()=>{v.disabled?bulmaJS.alert({message:"You need to unlock the field before clearing it.",contextualColorName:"info"}):(v.value=`(No ${o.escapedAliases.Lot})`,document.querySelector("#lotOccupancy--lotId").value="",i())}),o.initializeDatePickers(d),null===(a=document.querySelector("#lotOccupancy--occupancyStartDateString"))||void 0===a||a.addEventListener("change",()=>{const e=document.querySelector("#lotOccupancy--occupancyEndDateString").bulmaCalendar.datePicker;e.min=document.querySelector("#lotOccupancy--occupancyStartDateString").value,e.refresh()}),o.initializeUnlockFieldButtons(d),Object.defineProperty(exports,"__esModule",{value:!0});let f=exports.lotOccupancyOccupants;function O(e){const t=Number.parseInt(e.currentTarget.closest("tr").dataset.lotOccupantIndex,10),c=f.find(e=>e.lotOccupantIndex===t);let n,a;function l(e){e.preventDefault(),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doUpdateLotOccupancyOccupant",n,e=>{var t;const c=e;c.success?(f=c.lotOccupancyOccupants,a(),h()):bulmaJS.alert({title:"Error Updating "+o.escapedAliases.Occupant,message:null!==(t=c.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}cityssm.openHtmlModal("lotOccupancy-editOccupant",{onshow(e){var n;o.populateAliases(e),e.querySelector("#lotOccupancyOccupantEdit--lotOccupancyId").value=s,e.querySelector("#lotOccupancyOccupantEdit--lotOccupantIndex").value=t.toString();const a=e.querySelector("#lotOccupancyOccupantEdit--lotOccupantTypeId");let l=!1;for(const e of exports.lotOccupantTypes){const t=document.createElement("option");t.value=e.lotOccupantTypeId.toString(),t.textContent=e.lotOccupantType,t.dataset.occupantCommentTitle=e.occupantCommentTitle,t.dataset.fontAwesomeIconClass=e.fontAwesomeIconClass,e.lotOccupantTypeId===c.lotOccupantTypeId&&(t.selected=!0,l=!0),a.append(t)}if(!l){const e=document.createElement("option");e.value=c.lotOccupantTypeId.toString(),e.textContent=c.lotOccupantType,e.dataset.occupantCommentTitle=c.occupantCommentTitle,e.dataset.fontAwesomeIconClass=c.fontAwesomeIconClass,e.selected=!0,a.append(e)}e.querySelector("#lotOccupancyOccupantEdit--fontAwesomeIconClass").innerHTML=`<i class="fas fa-fw fa-${c.fontAwesomeIconClass}" aria-hidden="true"></i>`,e.querySelector("#lotOccupancyOccupantEdit--occupantName").value=c.occupantName,e.querySelector("#lotOccupancyOccupantEdit--occupantFamilyName").value=c.occupantFamilyName,e.querySelector("#lotOccupancyOccupantEdit--occupantAddress1").value=c.occupantAddress1,e.querySelector("#lotOccupancyOccupantEdit--occupantAddress2").value=c.occupantAddress2,e.querySelector("#lotOccupancyOccupantEdit--occupantCity").value=c.occupantCity,e.querySelector("#lotOccupancyOccupantEdit--occupantProvince").value=c.occupantProvince,e.querySelector("#lotOccupancyOccupantEdit--occupantPostalCode").value=c.occupantPostalCode,e.querySelector("#lotOccupancyOccupantEdit--occupantPhoneNumber").value=c.occupantPhoneNumber,e.querySelector("#lotOccupancyOccupantEdit--occupantEmailAddress").value=c.occupantEmailAddress,e.querySelector("#lotOccupancyOccupantEdit--occupantCommentTitle").textContent=""===(null!==(n=c.occupantCommentTitle)&&void 0!==n?n:"")?"Comment":c.occupantCommentTitle,e.querySelector("#lotOccupancyOccupantEdit--occupantComment").value=c.occupantComment},onshown(e,t){bulmaJS.toggleHtmlClipped();const c=e.querySelector("#lotOccupancyOccupantEdit--lotOccupantTypeId");c.focus(),c.addEventListener("change",()=>{var t,n;const a=null!==(t=c.selectedOptions[0].dataset.fontAwesomeIconClass)&&void 0!==t?t:"user";e.querySelector("#lotOccupancyOccupantEdit--fontAwesomeIconClass").innerHTML=`<i class="fas fa-fw fa-${a}" aria-hidden="true"></i>`;let o=null!==(n=c.selectedOptions[0].dataset.occupantCommentTitle)&&void 0!==n?n:"";""===o&&(o="Comment"),e.querySelector("#lotOccupancyOccupantEdit--occupantCommentTitle").textContent=o}),(n=e.querySelector("form")).addEventListener("submit",l),a=t},onremoved(){bulmaJS.toggleHtmlClipped()}})}function g(e){const t=e.currentTarget.closest("tr").dataset.lotOccupantIndex;bulmaJS.confirm({title:`Remove ${o.escapedAliases.Occupant}?`,message:`Are you sure you want to remove this ${o.escapedAliases.occupant}?`,okButton:{text:"Yes, Remove "+o.escapedAliases.Occupant,callbackFunction:function(){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyOccupant",{lotOccupancyId:s,lotOccupantIndex:t},e=>{var t;const c=e;c.success?(f=c.lotOccupancyOccupants,h()):bulmaJS.alert({title:"Error Removing "+o.escapedAliases.Occupant,message:null!==(t=c.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}},contextualColorName:"warning"})}function h(){var e,t,c,n,a,s,l,r,i,u,d;const p=document.querySelector("#container--lotOccupancyOccupants");if(cityssm.clearElement(p),0===f.length)return void(p.innerHTML=`<div class="message is-warning">\n            <p class="message-body">There are no ${o.escapedAliases.occupants} associated with this record.</p>\n            </div>`);const m=document.createElement("table");m.className="table is-fullwidth is-striped is-hoverable",m.innerHTML=`<thead><tr>\n          <th>${o.escapedAliases.Occupant}</th>\n          <th>Address</th>\n          <th>Other Contact</th>\n          <th>Comment</th>\n          <th class="is-hidden-print"><span class="is-sr-only">Options</span></th>\n          </tr></thead>\n          <tbody></tbody>`;for(const o of f){const p=document.createElement("tr");p.dataset.lotOccupantIndex=o.lotOccupantIndex.toString(),p.innerHTML="<td>"+cityssm.escapeHTML(""===(null!==(e=o.occupantName)&&void 0!==e?e:"")&&""===(null!==(t=o.occupantFamilyName)&&void 0!==t?t:"")?"(No Name)":o.occupantName+" "+o.occupantFamilyName)+'<br /><span class="tag"><i class="fas fa-fw fa-'+cityssm.escapeHTML(o.fontAwesomeIconClass)+'" aria-hidden="true"></i> <span class="ml-1">'+cityssm.escapeHTML(o.lotOccupantType)+"</span></span></td><td>"+(""===(null!==(c=o.occupantAddress1)&&void 0!==c?c:"")?"":cityssm.escapeHTML(o.occupantAddress1)+"<br />")+(""===(null!==(n=o.occupantAddress2)&&void 0!==n?n:"")?"":cityssm.escapeHTML(o.occupantAddress2)+"<br />")+(""===(null!==(a=o.occupantCity)&&void 0!==a?a:"")?"":cityssm.escapeHTML(o.occupantCity)+", ")+cityssm.escapeHTML(null!==(s=o.occupantProvince)&&void 0!==s?s:"")+"<br />"+cityssm.escapeHTML(null!==(l=o.occupantPostalCode)&&void 0!==l?l:"")+"</td><td>"+(""===(null!==(r=o.occupantPhoneNumber)&&void 0!==r?r:"")?"":cityssm.escapeHTML(o.occupantPhoneNumber)+"<br />")+(""===(null!==(i=o.occupantEmailAddress)&&void 0!==i?i:"")?"":cityssm.escapeHTML(o.occupantEmailAddress))+'</td><td><span data-tooltip="'+cityssm.escapeHTML(""===(null!==(u=o.occupantCommentTitle)&&void 0!==u?u:"")?"Comment":o.occupantCommentTitle)+'">'+cityssm.escapeHTML(null!==(d=o.occupantComment)&&void 0!==d?d:"")+'</span></td><td class="is-hidden-print"><div class="buttons are-small is-justify-content-end"><button class="button is-primary button--edit" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-light is-danger button--delete" data-tooltip="Delete '+cityssm.escapeHTML(exports.aliases.occupant)+'" type="button" aria-label="Delete"><i class="fas fa-trash" aria-hidden="true"></i></button></div></td>',p.querySelector(".button--edit").addEventListener("click",O),p.querySelector(".button--delete").addEventListener("click",g),m.querySelector("tbody").append(p)}p.append(m)}if(delete exports.lotOccupancyOccupants,l){const e=document.querySelector("#lotOccupancy--lotOccupantTypeId");e.addEventListener("change",()=>{var t;const c=d.querySelectorAll("[data-table='LotOccupancyOccupant']");for(const t of c)t.disabled=""===e.value;let n=null!==(t=e.selectedOptions[0].dataset.occupantCommentTitle)&&void 0!==t?t:"";""===n&&(n="Comment"),d.querySelector("#lotOccupancy--occupantCommentTitle").textContent=n})}else h();if(null===(S=document.querySelector("#button--addOccupant"))||void 0===S||S.addEventListener("click",()=>{let e,t,c,n;function a(t){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doAddLotOccupancyOccupant",t,t=>{var c;const n=t;n.success?(f=n.lotOccupancyOccupants,e(),h()):bulmaJS.alert({title:`Error Adding ${o.escapedAliases.Occupant}`,message:null!==(c=n.errorMessage)&&void 0!==c?c:"",contextualColorName:"danger"})})}function l(e){e.preventDefault(),a(t)}let r=[];function i(e){e.preventDefault();const t=e.currentTarget,c=r[Number.parseInt(t.dataset.index,10)],n=t.closest(".modal").querySelector("#lotOccupancyOccupantCopy--lotOccupantTypeId").value;""===n?bulmaJS.alert({title:`No ${o.escapedAliases.Occupant} Type Selected`,message:`Select a type to apply to the newly added ${o.escapedAliases.occupant}.`,contextualColorName:"warning"}):(c.lotOccupantTypeId=Number.parseInt(n,10),c.lotOccupancyId=Number.parseInt(s,10),a(c))}function u(e){e.preventDefault(),""!==c.querySelector("#lotOccupancyOccupantCopy--searchFilter").value?(n.innerHTML=o.getLoadingParagraphHTML("Searching..."),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doSearchPastOccupants",c,e=>{var t,c,a,o,s,l,u,d,p;r=e.occupants;const m=document.createElement("div");m.className="panel";for(const[e,n]of r.entries()){const r=document.createElement("a");r.className="panel-block is-block",r.dataset.index=e.toString(),r.innerHTML="<strong>"+cityssm.escapeHTML(null!==(t=n.occupantName)&&void 0!==t?t:"")+" "+cityssm.escapeHTML(null!==(c=n.occupantFamilyName)&&void 0!==c?c:"")+'</strong><br /><div class="columns"><div class="column">'+cityssm.escapeHTML(null!==(a=n.occupantAddress1)&&void 0!==a?a:"")+"<br />"+(""===(null!==(o=n.occupantAddress2)&&void 0!==o?o:"")?"":cityssm.escapeHTML(n.occupantAddress2)+"<br />")+cityssm.escapeHTML(null!==(s=n.occupantCity)&&void 0!==s?s:"")+", "+cityssm.escapeHTML(null!==(l=n.occupantProvince)&&void 0!==l?l:"")+"<br />"+cityssm.escapeHTML(null!==(u=n.occupantPostalCode)&&void 0!==u?u:"")+'</div><div class="column">'+(""===(null!==(d=n.occupantPhoneNumber)&&void 0!==d?d:"")?"":cityssm.escapeHTML(n.occupantPhoneNumber)+"<br />")+cityssm.escapeHTML(null!==(p=n.occupantEmailAddress)&&void 0!==p?p:"")+"<br /></div></div>",r.addEventListener("click",i),m.append(r)}n.innerHTML="",n.append(m)})):n.innerHTML='<div class="message is-info"><p class="message-body">Enter a partial name or address in the search field above.</p></div>'}cityssm.openHtmlModal("lotOccupancy-addOccupant",{onshow(e){o.populateAliases(e),e.querySelector("#lotOccupancyOccupantAdd--lotOccupancyId").value=s;const t=e.querySelector("#lotOccupancyOccupantAdd--lotOccupantTypeId"),c=e.querySelector("#lotOccupancyOccupantCopy--lotOccupantTypeId");for(const e of exports.lotOccupantTypes){const n=document.createElement("option");n.value=e.lotOccupantTypeId.toString(),n.textContent=e.lotOccupantType,n.dataset.occupantCommentTitle=e.occupantCommentTitle,n.dataset.fontAwesomeIconClass=e.fontAwesomeIconClass,t.append(n),c.append(n.cloneNode(!0))}e.querySelector("#lotOccupancyOccupantAdd--occupantCity").value=exports.occupantCityDefault,e.querySelector("#lotOccupancyOccupantAdd--occupantProvince").value=exports.occupantProvinceDefault},onshown(a,o){bulmaJS.toggleHtmlClipped(),bulmaJS.init(a);const s=a.querySelector("#lotOccupancyOccupantAdd--lotOccupantTypeId");s.focus(),s.addEventListener("change",()=>{var e,t;const c=null!==(e=s.selectedOptions[0].dataset.fontAwesomeIconClass)&&void 0!==e?e:"user";a.querySelector("#lotOccupancyOccupantAdd--fontAwesomeIconClass").innerHTML=`<i class="fas fa-fw fa-${c}" aria-hidden="true"></i>`;let n=null!==(t=s.selectedOptions[0].dataset.occupantCommentTitle)&&void 0!==t?t:"";""===n&&(n="Comment"),a.querySelector("#lotOccupancyOccupantAdd--occupantCommentTitle").textContent=n}),(t=a.querySelector("#form--lotOccupancyOccupantAdd")).addEventListener("submit",l),n=a.querySelector("#lotOccupancyOccupantCopy--searchResults"),(c=a.querySelector("#form--lotOccupancyOccupantCopy")).addEventListener("submit",e=>{e.preventDefault()}),a.querySelector("#lotOccupancyOccupantCopy--searchFilter").addEventListener("change",u),e=o},onremoved(){bulmaJS.toggleHtmlClipped(),document.querySelector("#button--addOccupant").focus()}})}),!l){var S;Object.defineProperty(exports,"__esModule",{value:!0});let e=exports.lotOccupancyComments;function b(t){const c=Number.parseInt(t.currentTarget.closest("tr").dataset.lotOccupancyCommentId,10),n=e.find(e=>e.lotOccupancyCommentId===c);let a,l;function r(t){t.preventDefault(),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doUpdateLotOccupancyComment",a,t=>{var c;t.success?(e=t.lotOccupancyComments,l(),T()):bulmaJS.alert({title:"Error Updating Comment",message:null!==(c=t.errorMessage)&&void 0!==c?c:"",contextualColorName:"danger"})})}cityssm.openHtmlModal("lotOccupancy-editComment",{onshow(e){o.populateAliases(e),e.querySelector("#lotOccupancyCommentEdit--lotOccupancyId").value=s,e.querySelector("#lotOccupancyCommentEdit--lotOccupancyCommentId").value=c.toString(),e.querySelector("#lotOccupancyCommentEdit--lotOccupancyComment").value=n.lotOccupancyComment;const t=e.querySelector("#lotOccupancyCommentEdit--lotOccupancyCommentDateString");t.value=n.lotOccupancyCommentDateString;const a=cityssm.dateToString(new Date);t.max=n.lotOccupancyCommentDateString<=a?a:n.lotOccupancyCommentDateString,e.querySelector("#lotOccupancyCommentEdit--lotOccupancyCommentTimeString").value=n.lotOccupancyCommentTimeString},onshown(e,t){bulmaJS.toggleHtmlClipped(),o.initializeDatePickers(e),e.querySelector("#lotOccupancyCommentEdit--lotOccupancyComment").focus(),(a=e.querySelector("form")).addEventListener("submit",r),l=t},onremoved(){bulmaJS.toggleHtmlClipped()}})}function C(t){const c=Number.parseInt(t.currentTarget.closest("tr").dataset.lotOccupancyCommentId,10);bulmaJS.confirm({title:"Remove Comment?",message:"Are you sure you want to remove this comment?",okButton:{text:"Yes, Remove Comment",callbackFunction:function(){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyComment",{lotOccupancyId:s,lotOccupancyCommentId:c},t=>{var c;t.success?(e=t.lotOccupancyComments,T()):bulmaJS.alert({title:"Error Removing Comment",message:null!==(c=t.errorMessage)&&void 0!==c?c:"",contextualColorName:"danger"})})}},contextualColorName:"warning"})}function T(){var t,c,n;const a=document.querySelector("#container--lotOccupancyComments");if(0===e.length)return void(a.innerHTML='<div class="message is-info"><p class="message-body">There are no comments associated with this record.</p></div>');const o=document.createElement("table");o.className="table is-fullwidth is-striped is-hoverable",o.innerHTML='<thead><tr><th>Commentor</th><th>Comment Date</th><th>Comment</th><th class="is-hidden-print"><span class="is-sr-only">Options</span></th></tr></thead><tbody></tbody>';for(const a of e){const e=document.createElement("tr");e.dataset.lotOccupancyCommentId=a.lotOccupancyCommentId.toString(),e.innerHTML="<td>"+cityssm.escapeHTML(null!==(t=a.recordCreate_userName)&&void 0!==t?t:"")+"</td><td>"+(null!==(c=a.lotOccupancyCommentDateString)&&void 0!==c?c:"")+(0===a.lotOccupancyCommentTime?"":" "+a.lotOccupancyCommentTimeString)+"</td><td>"+cityssm.escapeHTML(null!==(n=a.lotOccupancyComment)&&void 0!==n?n:"")+'</td><td class="is-hidden-print"><div class="buttons are-small is-justify-content-end"><button class="button is-primary button--edit" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-light is-danger button--delete" data-tooltip="Delete Comment" type="button" aria-label="Delete"><i class="fas fa-trash" aria-hidden="true"></i></button></div></td>',e.querySelector(".button--edit").addEventListener("click",b),e.querySelector(".button--delete").addEventListener("click",C),o.querySelector("tbody").append(e)}a.innerHTML="",a.append(o)}delete exports.lotOccupancyComments,null===(S=document.querySelector("#button--addComment"))||void 0===S||S.addEventListener("click",()=>{let t,c;function n(n){n.preventDefault(),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doAddLotOccupancyComment",t,t=>{var n;t.success?(e=t.lotOccupancyComments,c(),T()):bulmaJS.alert({title:"Error Adding Comment",message:null!==(n=t.errorMessage)&&void 0!==n?n:"",contextualColorName:"danger"})})}cityssm.openHtmlModal("lotOccupancy-addComment",{onshow(e){o.populateAliases(e),e.querySelector("#lotOccupancyCommentAdd--lotOccupancyId").value=s},onshown(e,a){bulmaJS.toggleHtmlClipped(),e.querySelector("#lotOccupancyCommentAdd--lotOccupancyComment").focus(),(t=e.querySelector("form")).addEventListener("submit",n),c=a},onremoved:()=>{bulmaJS.toggleHtmlClipped(),document.querySelector("#button--addComment").focus()}})}),T(),Object.defineProperty(exports,"__esModule",{value:!0});let t=exports.lotOccupancyFees;delete exports.lotOccupancyFees;const c=document.querySelector("#container--lotOccupancyFees");function x(){let e=0;for(const c of t)e+=(c.feeAmount+c.taxAmount)*c.quantity;return e}function L(e){const c=Number.parseInt(e.currentTarget.closest("tr").dataset.feeId,10),n=t.find(e=>e.feeId===c);if(void 0===n)return void bulmaJS.alert({title:"Fee Not Found",message:"Please refresh the page",contextualColorName:"danger"});let a;function l(e){e.preventDefault(),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doUpdateLotOccupancyFeeQuantity",e.currentTarget,e=>{const c=e;c.success?(t=c.lotOccupancyFees,N(),a()):bulmaJS.alert({title:"Error Updating Quantity",message:"Please try again.",contextualColorName:"danger"})})}cityssm.openHtmlModal("lotOccupancy-editFeeQuantity",{onshow(e){e.querySelector("#lotOccupancyFeeQuantity--lotOccupancyId").value=s,e.querySelector("#lotOccupancyFeeQuantity--feeId").value=n.feeId.toString(),e.querySelector("#lotOccupancyFeeQuantity--quantity").valueAsNumber=n.quantity,e.querySelector("#lotOccupancyFeeQuantity--quantityUnit").textContent=n.quantityUnit},onshown(e,t){var c;a=t,e.querySelector("#lotOccupancyFeeQuantity--quantity").focus(),null===(c=e.querySelector("form"))||void 0===c||c.addEventListener("submit",l)}})}function q(e){const c=e.currentTarget.closest(".container--lotOccupancyFee").dataset.feeId;bulmaJS.confirm({title:"Delete Fee",message:"Are you sure you want to delete this fee?",contextualColorName:"warning",okButton:{text:"Yes, Delete Fee",callbackFunction:function(){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyFee",{lotOccupancyId:s,feeId:c},e=>{var c;const n=e;n.success?(t=n.lotOccupancyFees,N()):bulmaJS.alert({title:"Error Deleting Fee",message:null!==(c=n.errorMessage)&&void 0!==c?c:"",contextualColorName:"danger"})})}}})}function N(){var e,n,a,o,s,l,r;if(0===t.length)return c.innerHTML='<div class="message is-info">\n                <p class="message-body">There are no fees associated with this record.</p>\n                </div>',void I();c.innerHTML='<table class="table is-fullwidth is-striped is-hoverable">\n              <thead><tr>\n                <th>Fee</th>\n                <th><span class="is-sr-only">Unit Cost</span></th>\n                <th class="has-width-1"><span class="is-sr-only">&times;</span></th>\n                <th class="has-width-1"><span class="is-sr-only">Quantity</span></th>\n                <th class="has-width-1"><span class="is-sr-only">equals</span></th>\n                <th class="has-width-1 has-text-right">Total</th>\n                <th class="has-width-1 is-hidden-print"><span class="is-sr-only">Options</span></th>\n              </tr></thead>\n              <tbody></tbody>\n              <tfoot><tr>\n                <th colspan="5">Subtotal</th>\n                <td class="has-text-weight-bold has-text-right" id="lotOccupancyFees--feeAmountTotal"></td>\n                <td class="is-hidden-print"></td>\n              </tr><tr>\n                <th colspan="5">Tax</th>\n                <td class="has-text-right" id="lotOccupancyFees--taxAmountTotal"></td>\n                <td class="is-hidden-print"></td>\n              </tr><tr>\n                <th colspan="5">Grand Total</th>\n                <td class="has-text-weight-bold has-text-right" id="lotOccupancyFees--grandTotal"></td>\n                <td class="is-hidden-print"></td>\n              </tr></tfoot></table>';let i=0,u=0;for(const d of t){const t=document.createElement("tr");t.className="container--lotOccupancyFee",t.dataset.feeId=d.feeId.toString(),t.dataset.includeQuantity=null!==(e=d.includeQuantity)&&void 0!==e&&e?"1":"0",t.innerHTML='<td colspan="'+(1===d.quantity?"5":"1")+'">'+cityssm.escapeHTML(null!==(n=d.feeName)&&void 0!==n?n:"")+'<br /><span class="tag">'+cityssm.escapeHTML(null!==(a=d.feeCategory)&&void 0!==a?a:"")+"</span></td>"+(1===d.quantity?"":'<td class="has-text-right">$'+d.feeAmount.toFixed(2)+'</td><td>&times;</td><td class="has-text-right">'+d.quantity.toString()+"</td><td>=</td>")+'<td class="has-text-right">$'+(d.feeAmount*d.quantity).toFixed(2)+'</td><td class="is-hidden-print"><div class="buttons are-small is-flex-wrap-nowrap is-justify-content-end">'+(null!==(o=d.includeQuantity)&&void 0!==o&&o?'<button class="button is-primary button--editQuantity"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button>':"")+'<button class="button is-danger is-light button--delete" data-tooltip="Delete Fee" type="button"><i class="fas fa-trash" aria-hidden="true"></i></button></div></td>',null===(s=t.querySelector(".button--editQuantity"))||void 0===s||s.addEventListener("click",L),null===(l=t.querySelector(".button--delete"))||void 0===l||l.addEventListener("click",q),null===(r=c.querySelector("tbody"))||void 0===r||r.append(t),i+=d.feeAmount*d.quantity,u+=d.taxAmount*d.quantity}c.querySelector("#lotOccupancyFees--feeAmountTotal").textContent="$"+i.toFixed(2),c.querySelector("#lotOccupancyFees--taxAmountTotal").textContent="$"+u.toFixed(2),c.querySelector("#lotOccupancyFees--grandTotal").textContent="$"+(i+u).toFixed(2),I()}const n=document.querySelector("#button--addFee");n.addEventListener("click",()=>{if(o.hasUnsavedChanges())return void bulmaJS.alert({message:"Please save all unsaved changes before adding fees.",contextualColorName:"warning"});let e,a,l;function r(e,c=1){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doAddLotOccupancyFee",{lotOccupancyId:s,feeId:e,quantity:c},e=>{var c;const n=e;n.success?(t=n.lotOccupancyFees,N(),u()):bulmaJS.alert({title:"Error Adding Fee",message:null!==(c=n.errorMessage)&&void 0!==c?c:"",contextualColorName:"danger"})})}function i(t){var c;t.preventDefault();const n=Number.parseInt(t.currentTarget.dataset.feeId,10),a=Number.parseInt(t.currentTarget.dataset.feeCategoryId,10),o=e.find(e=>e.feeCategoryId===a).fees.find(e=>e.feeId===n);null!==(c=o.includeQuantity)&&void 0!==c&&c?function(e){let t,c;function n(n){n.preventDefault(),r(e.feeId,t.value),c()}cityssm.openHtmlModal("lotOccupancy-setFeeQuantity",{onshow(t){t.querySelector("#lotOccupancyFeeQuantity--quantityUnit").textContent=e.quantityUnit},onshown(e,a){c=a,t=e.querySelector("#lotOccupancyFeeQuantity--quantity"),e.querySelector("form").addEventListener("submit",n)}})}(o):r(n)}function u(){var t,n,o,s,r,u;const d=a.value.trim().toLowerCase().split(" ");l.innerHTML="";for(const a of e){const e=document.createElement("div");e.className="container--feeCategory",e.dataset.feeCategoryId=a.feeCategoryId.toString(),e.innerHTML='<h4 class="title is-5 mt-2">'+cityssm.escapeHTML(null!==(t=a.feeCategory)&&void 0!==t?t:"")+'</h4><div class="panel mb-5"></div>';let p=!1;for(const t of a.fees){if(null!==c.querySelector(`.container--lotOccupancyFee[data-fee-id='${t.feeId}'][data-include-quantity='0']`))continue;let l=!0;const m=((null!==(n=a.feeCategory)&&void 0!==n?n:"")+" "+(null!==(o=t.feeName)&&void 0!==o?o:"")+" "+(null!==(s=t.feeDescription)&&void 0!==s?s:"")).toLowerCase();for(const e of d)if(!m.includes(e)){l=!1;break}if(!l)continue;p=!0;const y=document.createElement("a");y.className="panel-block is-block container--fee",y.dataset.feeId=t.feeId.toString(),y.dataset.feeCategoryId=a.feeCategoryId.toString(),y.href="#",y.innerHTML="<strong>"+cityssm.escapeHTML(null!==(r=t.feeName)&&void 0!==r?r:"")+"</strong><br /><small>"+cityssm.escapeHTML(null!==(u=t.feeDescription)&&void 0!==u?u:"").replace(/\n/g,"<br />")+"</small>",y.addEventListener("click",i),e.querySelector(".panel").append(y)}p&&l.append(e)}}cityssm.openHtmlModal("lotOccupancy-addFee",{onshow(t){a=t.querySelector("#feeSelect--feeName"),l=t.querySelector("#resultsContainer--feeSelect"),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doGetFees",{lotOccupancyId:s},t=>{e=t.feeCategories,a.disabled=!1,a.addEventListener("keyup",u),a.focus(),u()})},onshown(){bulmaJS.toggleHtmlClipped()},onhidden(){N()},onremoved(){bulmaJS.toggleHtmlClipped(),n.focus()}})});let a=exports.lotOccupancyTransactions;delete exports.lotOccupancyTransactions;const l=document.querySelector("#container--lotOccupancyTransactions");function E(e){const t=e.currentTarget.closest(".container--lotOccupancyTransaction").dataset.transactionIndex;bulmaJS.confirm({title:"Delete Trasnaction",message:"Are you sure you want to delete this transaction?",contextualColorName:"warning",okButton:{text:"Yes, Delete Transaction",callbackFunction:function(){cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doDeleteLotOccupancyTransaction",{lotOccupancyId:s,transactionIndex:t},e=>{var t;const c=e;c.success?(a=c.lotOccupancyTransactions,I()):bulmaJS.alert({title:"Error Deleting Transaction",message:null!==(t=c.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}}})}function I(){var e,c,n;if(0===a.length)return void(l.innerHTML='<div class="message '+(0===t.length?"is-info":"is-warning")+'"><p class="message-body">There are no transactions associated with this record.</p></div>');l.innerHTML=`<table class="table is-fullwidth is-striped is-hoverable">\n              <thead><tr>\n                <th class="has-width-1">Date</th>\n                <th>${o.escapedAliases.ExternalReceiptNumber}</th>\n                <th class="has-text-right has-width-1">Amount</th>\n                <th class="has-width-1 is-hidden-print"><span class="is-sr-only">Options</span></th>\n              </tr></thead>\n              <tbody></tbody>\n              <tfoot><tr>\n                <th colspan="2">Transaction Total</th>\n                <td class="has-text-weight-bold has-text-right" id="lotOccupancyTransactions--grandTotal"></td>\n                <td class="is-hidden-print"></td>\n              </tr></tfoot>\n              </table>`;let s=0;for(const t of a){s+=t.transactionAmount;const a=document.createElement("tr");a.className="container--lotOccupancyTransaction",a.dataset.transactionIndex=t.transactionIndex.toString();let r="";""!==t.externalReceiptNumber&&(r=cityssm.escapeHTML(null!==(e=t.externalReceiptNumber)&&void 0!==e?e:""),o.dynamicsGPIntegrationIsEnabled&&(void 0===t.dynamicsGPDocument?r+=' <span data-tooltip="No Matching Document Found">\n                    <i class="fas fa-times-circle has-text-danger" aria-label="No Matching Document Found"></i>\n                    </span>':t.dynamicsGPDocument.documentTotal.toFixed(2)===t.transactionAmount.toFixed(2)?r+=' <span data-tooltip="Matching Document Found">\n                    <i class="fas fa-check-circle has-text-success" aria-label="Matching Document Found"></i>\n                    </span>':r+=` <span data-tooltip="Matching Document: $${t.dynamicsGPDocument.documentTotal.toFixed(2)}">\n                    <i class="fas fa-check-circle has-text-warning" aria-label="Matching Document: $${t.dynamicsGPDocument.documentTotal.toFixed(2)}"></i>\n                    </span>`),r+="<br />"),a.innerHTML="<td>"+(null!==(c=t.transactionDateString)&&void 0!==c?c:"")+"</td><td>"+r+"<small>"+cityssm.escapeHTML(null!==(n=t.transactionNote)&&void 0!==n?n:"")+'</small></td><td class="has-text-right">$'+t.transactionAmount.toFixed(2)+'</td><td class="is-hidden-print"><button class="button is-small is-danger is-light" data-tooltip="Delete Transaction" type="button"><i class="fas fa-trash" aria-hidden="true"></i></button></td>',a.querySelector("button").addEventListener("click",E),l.querySelector("tbody").append(a)}l.querySelector("#lotOccupancyTransactions--grandTotal").textContent="$"+s.toFixed(2);const r=x();r.toFixed(2)!==s.toFixed(2)&&l.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body"><div class="level"><div class="level-left"><div class="level-item">Outstanding Balance</div></div><div class="level-right"><div class="level-item">$'+(r-s).toFixed(2)+"</div></div></div></div></div>")}const r=document.querySelector("#button--addTransaction");r.addEventListener("click",()=>{let e,t,c;function n(e){e.preventDefault(),cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doAddLotOccupancyTransaction",e.currentTarget,e=>{var t;const n=e;n.success?(a=n.lotOccupancyTransactions,c(),I()):bulmaJS.confirm({title:"Error Adding Transaction",message:null!==(t=n.errorMessage)&&void 0!==t?t:"",contextualColorName:"danger"})})}function l(){const c=t.value,n=t.closest(".control").querySelector(".icon"),a=t.closest(".field").querySelector(".help");if(""===c)return a.innerHTML="&nbsp;",void(n.innerHTML='<i class="fas fa-minus" aria-hidden="true"></i>');cityssm.postJSON(o.urlPrefix+"/lotOccupancies/doGetDynamicsGPDocument",{externalReceiptNumber:c},t=>{const c=t;c.success&&void 0!==c.dynamicsGPDocument?e.valueAsNumber===c.dynamicsGPDocument.documentTotal?(a.textContent="Matching Document Found",n.innerHTML='<i class="fas fa-check-circle" aria-hidden="true"></i>'):(a.textContent="Matching Document: $"+c.dynamicsGPDocument.documentTotal.toFixed(2),n.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>'):(a.textContent="No Matching Document Found",n.innerHTML='<i class="fas fa-times-circle" aria-hidden="true"></i>')})}cityssm.openHtmlModal("lotOccupancy-addTransaction",{onshow(c){o.populateAliases(c),c.querySelector("#lotOccupancyTransactionAdd--lotOccupancyId").value=s.toString();const n=x(),r=function(){let e=0;for(const t of a)e+=t.transactionAmount;return e}();if((e=c.querySelector("#lotOccupancyTransactionAdd--transactionAmount")).min=(-1*r).toFixed(2),e.max=Math.max(n-r,0).toFixed(2),e.value=Math.max(n-r,0).toFixed(2),o.dynamicsGPIntegrationIsEnabled){const n=(t=c.querySelector("#lotOccupancyTransactionAdd--externalReceiptNumber")).closest(".control");n.classList.add("has-icons-right"),n.insertAdjacentHTML("beforeend",'<span class="icon is-small is-right"></span>'),n.insertAdjacentHTML("afterend",'<p class="help has-text-right"></p>'),t.addEventListener("change",l),e.addEventListener("change",l),l()}},onshown(t,a){bulmaJS.toggleHtmlClipped(),e.focus(),c=a,t.querySelector("form").addEventListener("submit",n)},onremoved(){bulmaJS.toggleHtmlClipped(),r.focus()}})}),N()}})();